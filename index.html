<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Vape Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #22c55e; /* Toxic Green */
            --bg-black: #050505;
            --card-bg: rgba(20, 20, 20, 0.6);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-black);
            color: white;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* –¢–µ—Ö–Ω–æ-—Ñ–æ–Ω –≤–º–µ—Å—Ç–æ —Å—Ñ–µ—Ä */
        .tech-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: 
                radial-gradient(circle at 50% -20%, var(--primary) 0%, transparent 40%),
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90px, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 100% 100%, 30px 30px, 30px 30px;
            opacity: 0.4;
        }

        .scan-line {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: linear-gradient(to bottom, transparent, rgba(34, 197, 94, 0.05), transparent);
            height: 100px;
            width: 100%;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            from { transform: translateY(-100vh); }
            to { transform: translateY(100vh); }
        }

        .glass {
            backdrop-filter: blur(25px);
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        .theme-toxic { --primary: #22c55e; }
        .theme-ice { --primary: #0ea5e9; }
        .theme-magma { --primary: #f97316; }

        .text-primary { color: var(--primary); }
        .bg-primary { background-color: var(--primary); }
        .border-primary { border-color: var(--primary); }

        .loader-overlay {
            position: fixed;
            inset: 0;
            background: black;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s;
        }

        ::-webkit-scrollbar { width: 0px; }

        .product-card {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .bottom-sheet {
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bottom-sheet.active {
            transform: translateY(0);
        }

        .category-pill.active {
            background-color: var(--primary);
            color: black;
            border-color: var(--primary);
        }
    </style>

    <script>
        window.hideLoader = function() {
            const loader = document.getElementById('loader');
            const app = document.getElementById('app');
            if (loader) {
                loader.style.opacity = '0';
                loader.style.visibility = 'hidden';
                setTimeout(() => {
                    loader.style.display = 'none';
                    if (app) app.classList.remove('hidden');
                }, 500);
            }
        };
        setTimeout(window.hideLoader, 2500);
    </script>
</head>
<body class="theme-toxic">
    <div id="loader" class="loader-overlay">
        <div class="flex flex-col items-center">
            <div class="w-12 h-12 border-4 border-white/10 border-t-primary rounded-full animate-spin"></div>
            <p class="mt-4 text-xs font-bold tracking-[0.3em] uppercase opacity-40">System Init</p>
        </div>
    </div>

    <div class="tech-bg"></div>
    <div class="scan-line"></div>

    <div id="app" class="px-4 pb-32 pt-6 max-w-2xl mx-auto min-h-screen relative z-10 hidden">
        
        <!-- Store View -->
        <div id="view-store">
            <header class="flex items-center justify-between mb-8">
                <div>
                    <h1 id="admin-status" class="text-[10px] font-bold tracking-[0.3em] text-white/30 mb-1 uppercase">CORE INTERFACE v2.0</h1>
                    <h2 class="text-2xl font-black italic tracking-tighter uppercase">Vapor<span class="text-primary">Tech</span></h2>
                </div>
                <div class="flex items-center gap-2">
                    <div id="admin-controls" class="hidden flex items-center gap-2">
                        <button onclick="window.showAddProduct()" class="p-2.5 glass rounded-xl text-primary border-primary/30">
                            <i data-lucide="plus-square" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <button onclick="window.nextTheme()" class="p-2.5 glass rounded-xl">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                    </button>
                </div>
            </header>

            <!-- Search -->
            <div class="glass rounded-2xl flex items-center px-4 py-3.5 mb-6">
                <i data-lucide="search" class="w-5 h-5 opacity-30 mr-3"></i>
                <input type="text" oninput="window.filterProducts(this.value)" placeholder="–ü–æ–∏—Å–∫ –¥–µ–≤–∞–π—Å–∞..." class="bg-transparent border-none outline-none w-full text-sm font-medium">
            </div>

            <!-- Categories -->
            <div class="flex gap-2 overflow-x-auto pb-4 mb-4 no-scrollbar">
                <button onclick="window.setCategory('all')" class="category-pill active shrink-0 px-6 py-2.5 glass rounded-full text-xs font-bold uppercase tracking-wider border border-white/5 transition-all" data-cat="all">–í—Å–µ</button>
                <button onclick="window.setCategory('Disposable')" class="category-pill shrink-0 px-6 py-2.5 glass rounded-full text-xs font-bold uppercase tracking-wider border border-white/5 transition-all" data-cat="Disposable">–û–¥–Ω–æ—Ä–∞–∑–∫–∏</button>
                <button onclick="window.setCategory('Device')" class="category-pill shrink-0 px-6 py-2.5 glass rounded-full text-xs font-bold uppercase tracking-wider border border-white/5 transition-all" data-cat="Device">–ü–æ–¥-—Å–∏—Å—Ç–µ–º—ã</button>
                <button onclick="window.setCategory('Liquid')" class="category-pill shrink-0 px-6 py-2.5 glass rounded-full text-xs font-bold uppercase tracking-wider border border-white/5 transition-all" data-cat="Liquid">–ñ–∏–¥–∫–æ—Å—Ç–∏</button>
            </div>

            <div id="products-grid" class="grid grid-cols-2 gap-3">
                <div class="glass p-4 rounded-3xl animate-pulse h-64"></div>
                <div class="glass p-4 rounded-3xl animate-pulse h-64"></div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="view-profile" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
            <h2 class="text-3xl font-black uppercase mb-8 italic">User <span class="text-primary">Profile</span></h2>
            
            <div class="glass rounded-[32px] p-8 text-center mb-6">
                <div id="user-avatar" class="w-24 h-24 bg-primary/20 text-primary rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-primary/50 shadow-[0_0_30px_rgba(34,197,94,0.3)]">
                    <i data-lucide="user" class="w-12 h-12"></i>
                </div>
                <h3 id="user-full-name" class="text-xl font-bold mb-1">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                <p id="user-tg-tag" class="text-primary font-mono text-sm opacity-70">@username</p>
                
                <div class="grid grid-cols-2 gap-3 mt-8">
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/5 text-left">
                        <p class="text-[10px] uppercase opacity-40 mb-1">Telegram ID</p>
                        <p id="user-id" class="font-mono text-xs font-bold tracking-tighter">00000000</p>
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/5 text-left">
                        <p class="text-[10px] uppercase opacity-40 mb-1">–°—Ç–∞—Ç—É—Å</p>
                        <p id="user-rank" class="text-xs font-bold">Standard</p>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <div class="glass p-5 rounded-2xl flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <i data-lucide="package" class="text-primary"></i>
                        <span class="font-bold text-sm">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</span>
                    </div>
                    <i data-lucide="chevron-right" class="opacity-30"></i>
                </div>
                <div class="glass p-5 rounded-2xl flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <i data-lucide="heart" class="text-red-500"></i>
                        <span class="font-bold text-sm">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                    </div>
                    <i data-lucide="chevron-right" class="opacity-30"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed bottom-6 left-4 right-4 h-18 glass rounded-[24px] flex items-center justify-around z-40 px-2 max-w-2xl mx-auto border border-white/10 shadow-2xl">
        <button onclick="window.switchView('store')" id="nav-store" class="flex flex-col items-center justify-center w-full gap-1 text-primary transition-all">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-[9px] font-black uppercase tracking-widest">Store</span>
        </button>
        <button onclick="window.toggleCart()" class="flex flex-col items-center justify-center w-full gap-1 opacity-40 relative">
            <i data-lucide="shopping-bag" class="w-6 h-6"></i>
            <span class="text-[9px] font-black uppercase tracking-widest">Cart</span>
            <div id="cart-badge" class="hidden absolute top-0 right-1/4 bg-primary text-black text-[10px] font-bold px-1.5 rounded-full border border-black">0</div>
        </button>
        <button onclick="window.switchView('profile')" id="nav-profile" class="flex flex-col items-center justify-center w-full gap-1 opacity-40 transition-all">
            <i data-lucide="user-cog" class="w-6 h-6"></i>
            <span class="text-[9px] font-black uppercase tracking-widest">User</span>
        </button>
    </nav>

    <!-- Cart (Bottom Sheet) -->
    <div id="cart-sheet" class="fixed inset-0 z-50 pointer-events-none">
        <div id="cart-overlay" onclick="window.toggleCart()" class="absolute inset-0 bg-black/80 opacity-0 transition-opacity pointer-events-none"></div>
        <div class="bottom-sheet absolute bottom-0 left-0 right-0 bg-zinc-950 border-t border-white/10 rounded-t-[40px] max-h-[90vh] flex flex-col pointer-events-auto shadow-[0_-20px_50px_rgba(0,0,0,0.5)]">
            <div class="w-12 h-1.5 bg-white/10 rounded-full mx-auto my-5"></div>
            <div class="px-8 pb-6 flex items-center justify-between">
                <h3 class="text-2xl font-black uppercase italic">Your <span class="text-primary">Cart</span></h3>
                <button onclick="window.toggleCart()" class="p-2 glass rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="cart-items" class="flex-grow overflow-y-auto px-8 py-2 space-y-4 no-scrollbar">
                <p class="text-center opacity-20 py-20 font-bold uppercase tracking-tighter">System: Empty</p>
            </div>
            <div class="p-8 glass border-t border-white/10 rounded-t-[32px]">
                <div class="flex justify-between mb-6">
                    <span class="opacity-40 font-bold uppercase text-xs">Total Amount</span>
                    <span id="cart-total" class="text-2xl font-black tracking-tighter">0 ‚ÇΩ</span>
                </div>
                <button onclick="window.startCheckout()" class="w-full bg-primary text-black font-black py-5 rounded-2xl flex items-center justify-center gap-3 uppercase italic tracking-wider shadow-[0_0_30px_rgba(34,197,94,0.4)] active:scale-95 transition-transform">
                    Checkout Now
                    <i data-lucide="chevron-right" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modals (Add Product, Checkout, Payment) - Logic Remains Same -->
    <div id="add-product-modal" class="fixed inset-0 z-[80] glass hidden items-center justify-center p-4">
        <div class="bg-zinc-950 border border-white/10 w-full max-w-md rounded-[32px] p-8">
            <h3 class="text-xl font-black uppercase mb-6 italic text-primary">Add New Item</h3>
            <div class="space-y-4">
                <input type="text" id="p-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-primary">
                <input type="number" id="p-price" placeholder="–¶–µ–Ω–∞ (‚ÇΩ)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-primary">
                <input type="text" id="p-image" placeholder="Emoji –¥–µ–≤–∞–π—Å–∞" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-primary">
                <select id="p-tag" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-primary">
                    <option value="Disposable">–û–¥–Ω–æ—Ä–∞–∑–∫–∞</option>
                    <option value="Liquid">–ñ–∏–¥–∫–æ—Å—Ç—å</option>
                    <option value="Device">–ü–æ–¥-—Å–∏—Å—Ç–µ–º–∞</option>
                </select>
                <div class="flex gap-3 pt-6">
                    <button onclick="window.closeAddProduct()" class="w-full py-4 text-white/30 font-bold uppercase text-xs">Cancel</button>
                    <button onclick="window.saveProduct()" class="w-full bg-primary text-black font-black py-4 rounded-xl uppercase tracking-widest italic">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, query, onSnapshot, deleteDoc, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth;
        const tg = window.Telegram?.WebApp;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'vape-tech-pro';

        window.state = {
            products: [],
            filteredProducts: [],
            cart: [],
            currentCategory: 'all',
            isAdmin: false,
            currentTheme: 'toxic'
        };

        const ADMIN_ID = 1262669099;
        const ADMIN_USER = "Tru5tNoBody";

        // Firebase Init
        const initFirebase = async () => {
            try {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) loadData();
                });
            } catch (e) {
                console.error(e);
                window.hideLoader();
            }
        };

        const loadData = () => {
            const q = collection(db, 'artifacts', appId, 'public', 'data', 'vape_items');
            onSnapshot(q, (snap) => {
                const items = [];
                snap.forEach(d => items.push({ id: d.id, ...d.data() }));
                window.state.products = items;
                applyFilters();
                if (items.length === 0 && window.state.isAdmin) seedData();
                window.hideLoader();
            }, () => window.hideLoader());
        };

        const seedData = async () => {
            const starters = [
                { name: "XROS 4 Mini", price: 2990, icon: "‚ö°", tag: "Device" },
                { name: "HQD Ultima 6000", price: 1400, icon: "üå™Ô∏è", tag: "Disposable" },
                { name: "Husky White Lul", price: 550, icon: "‚ùÑÔ∏è", tag: "Liquid" },
                { name: "Vaporesso Luxe Q2", price: 3400, icon: "üîã", tag: "Device" },
                { name: "Gang X 10000", price: 1950, icon: "üí®", tag: "Disposable" },
                { name: "Brusko Glitch", price: 450, icon: "üíß", tag: "Liquid" }
            ];
            const col = collection(db, 'artifacts', appId, 'public', 'data', 'vape_items');
            for (let s of starters) await addDoc(col, s);
        };

        // Views
        window.switchView = (v) => {
            tg?.HapticFeedback.impactOccurred('light');
            const s = document.getElementById('view-store');
            const p = document.getElementById('view-profile');
            const ns = document.getElementById('nav-store');
            const np = document.getElementById('nav-profile');

            if (v === 'store') {
                s.classList.remove('hidden');
                p.classList.add('hidden');
                ns.classList.replace('opacity-40', 'text-primary');
                np.classList.replace('text-primary', 'opacity-40');
            } else {
                s.classList.add('hidden');
                p.classList.remove('hidden');
                np.classList.replace('opacity-40', 'text-primary');
                ns.classList.replace('text-primary', 'opacity-40');
                renderUserProfile();
            }
        };

        const renderUserProfile = () => {
            const user = tg?.initDataUnsafe?.user || {
                first_name: "Web User",
                last_name: "(Demo)",
                username: "browser_user",
                id: 0
            };
            document.getElementById('user-full-name').innerText = `${user.first_name} ${user.last_name || ''}`;
            document.getElementById('user-tg-tag').innerText = `@${user.username || 'unknown'}`;
            document.getElementById('user-id').innerText = user.id;
            document.getElementById('user-rank').innerText = window.state.isAdmin ? "ADMIN" : "Standard";
            if (window.state.isAdmin) document.getElementById('user-rank').classList.add('text-primary');
        };

        // Categories
        window.setCategory = (c) => {
            tg?.HapticFeedback.selectionChanged();
            window.state.currentCategory = c;
            document.querySelectorAll('.category-pill').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.cat === c);
            });
            applyFilters();
        };

        const applyFilters = (search = "") => {
            let res = window.state.products;
            if (window.state.currentCategory !== 'all') {
                res = res.filter(p => p.tag === window.state.currentCategory);
            }
            if (search) {
                res = res.filter(p => p.name.toLowerCase().includes(search.toLowerCase()));
            }
            window.state.filteredProducts = res;
            renderProducts();
        };

        window.filterProducts = (v) => applyFilters(v);

        const renderProducts = () => {
            const grid = document.getElementById('products-grid');
            if (window.state.filteredProducts.length === 0) {
                grid.innerHTML = '<div class="col-span-2 text-center py-20 opacity-20 font-bold">NO_DEVICES_FOUND</div>';
                return;
            }
            grid.innerHTML = window.state.filteredProducts.map(p => `
                <div class="product-card glass p-4 rounded-[24px] relative group overflow-hidden">
                    ${window.state.isAdmin ? `<button onclick="window.deleteProduct('${p.id}')" class="absolute top-2 right-2 p-2 bg-red-500/20 text-red-500 rounded-lg z-20"><i data-lucide="trash-2" class="w-4 h-4"></i></button>` : ''}
                    <div class="flex-grow flex flex-col">
                        <div class="w-full aspect-square bg-white/5 rounded-2xl flex items-center justify-center text-5xl mb-4 group-hover:scale-110 transition-transform duration-500 shadow-inner">
                            ${p.icon}
                        </div>
                        <p class="text-[9px] font-black text-primary uppercase tracking-[0.2em] mb-1 opacity-70">${p.tag}</p>
                        <h3 class="font-bold text-sm tracking-tight mb-3 line-clamp-2">${p.name}</h3>
                    </div>
                    <div class="flex items-center justify-between mt-auto pt-2">
                        <span class="font-black text-lg tracking-tighter">${p.price} ‚ÇΩ</span>
                        <button onclick="window.addToCart('${p.id}')" class="bg-primary text-black p-2.5 rounded-xl active:scale-90 transition-all shadow-[0_4px_15px_rgba(34,197,94,0.3)]">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        };

        // Admin
        const checkAdmin = () => {
            const u = tg?.initDataUnsafe?.user;
            if (u?.id === ADMIN_ID || u?.username === ADMIN_USER || (window.location.hostname === 'localhost')) {
                window.state.isAdmin = true;
                document.getElementById('admin-controls').classList.remove('hidden');
                document.getElementById('admin-status').innerText = 'ADMIN_ACCESS: GRANTED';
                document.getElementById('admin-status').classList.replace('text-white/30', 'text-primary');
                renderProducts();
            }
        };

        // Theme
        window.nextTheme = () => {
            const themes = ['toxic', 'ice', 'magma'];
            let idx = (themes.indexOf(window.state.currentTheme) + 1) % themes.length;
            window.state.currentTheme = themes[idx];
            document.body.className = `theme-${window.state.currentTheme}`;
            tg?.HapticFeedback.impactOccurred('medium');
        };

        // Cart
        window.addToCart = (id) => {
            const p = window.state.products.find(x => x.id === id);
            const exist = window.state.cart.find(x => x.id === id);
            if (exist) exist.qty++;
            else window.state.cart.push({...p, qty: 1});
            updateCartUI();
            tg?.HapticFeedback.notificationOccurred('success');
        };

        window.updateQty = (id, d) => {
            const i = window.state.cart.find(x => x.id === id);
            if (i) {
                i.qty += d;
                if (i.qty <= 0) window.state.cart = window.state.cart.filter(x => x.id !== id);
                updateCartUI();
            }
        };

        const updateCartUI = () => {
            const totalCount = window.state.cart.reduce((s, i) => s + i.qty, 0);
            const badge = document.getElementById('cart-badge');
            badge.innerText = totalCount;
            badge.classList.toggle('hidden', totalCount === 0);

            const container = document.getElementById('cart-items');
            if (window.state.cart.length === 0) {
                container.innerHTML = '<p class="text-center opacity-20 py-20 font-bold uppercase tracking-tighter">System: Empty</p>';
            } else {
                container.innerHTML = window.state.cart.map(i => `
                    <div class="flex items-center gap-4 bg-white/5 p-4 rounded-2xl border border-white/5">
                        <div class="w-14 h-14 glass rounded-xl flex items-center justify-center text-2xl">${i.icon}</div>
                        <div class="flex-grow">
                            <h4 class="text-xs font-bold uppercase">${i.name}</h4>
                            <p class="text-primary font-black text-sm">${i.price} ‚ÇΩ</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="window.updateQty('${i.id}', -1)" class="w-8 h-8 glass rounded-lg flex items-center justify-center">-</button>
                            <span class="font-bold text-sm">${i.qty}</span>
                            <button onclick="window.updateQty('${i.id}', 1)" class="w-8 h-8 glass rounded-lg flex items-center justify-center">+</button>
                        </div>
                    </div>
                `).join('');
            }
            const totalSum = window.state.cart.reduce((s, i) => s + (i.price * i.qty), 0);
            document.getElementById('cart-total').innerText = `${totalSum} ‚ÇΩ`;
            lucide.createIcons();
        };

        window.toggleCart = () => {
            const s = document.getElementById('cart-sheet');
            const o = document.getElementById('cart-overlay');
            const c = s.querySelector('.bottom-sheet');
            const isOpen = c.classList.contains('active');

            if (isOpen) {
                c.classList.remove('active');
                o.classList.add('opacity-0');
                setTimeout(() => { s.classList.add('pointer-events-none'); o.classList.add('pointer-events-none'); }, 300);
            } else {
                s.classList.remove('pointer-events-none');
                o.classList.remove('pointer-events-none');
                o.classList.remove('opacity-0');
                c.classList.add('active');
                tg?.HapticFeedback.impactOccurred('medium');
            }
        };

        // Admin Actions
        window.showAddProduct = () => document.getElementById('add-product-modal').classList.replace('hidden', 'flex');
        window.closeAddProduct = () => document.getElementById('add-product-modal').classList.replace('flex', 'hidden');
        window.saveProduct = async () => {
            const name = document.getElementById('p-name').value;
            const price = parseInt(document.getElementById('p-price').value);
            const icon = document.getElementById('p-image').value;
            const tag = document.getElementById('p-tag').value;
            if (name && !isNaN(price)) {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'vape_items'), { name, price, icon: icon || "üí®", tag });
                window.closeAddProduct();
                tg?.HapticFeedback.notificationOccurred('success');
            }
        };
        window.deleteProduct = async (id) => {
            if (confirm('Delete item?')) await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'vape_items', id));
        };

        window.onload = () => {
            tg?.ready();
            tg?.expand();
            initFirebase();
            checkAdmin();
            setTimeout(checkAdmin, 1000);
            lucide.createIcons();
        };
    </script>
</body>
</html>
