<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VŒõPOR CLOUD | Premium Store</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        window.fb = { initializeApp, getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, onSnapshot, query, where, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');

        :root {
            --primary-glow: #22c55e; /* Toxic Green */
            --bg-deep: #050505;
            --card-bg: rgba(15, 15, 15, 0.75);
            --border-white: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: #ffffff;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .cyber-bg {
            background: radial-gradient(circle at 50% 120%, rgba(34, 197, 94, 0.15), transparent 70%);
            position: fixed;
            inset: 0;
            z-index: -1;
        }

        .vapor-cloud {
            position: fixed;
            width: 400px;
            height: 400px;
            background: var(--primary-glow);
            filter: blur(150px);
            opacity: 0.04;
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
            animation: drift 20s infinite alternate ease-in-out;
        }

        @keyframes drift {
            from { transform: translate(-10%, -10%); }
            to { transform: translate(20%, 30%); }
        }

        .glass {
            backdrop-filter: blur(40px) saturate(180%);
            background: var(--card-bg);
            border: 1px solid var(--border-white);
        }

        .neon-drop {
            filter: drop-shadow(0 0 8px var(--primary-glow));
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .active-tab {
            color: var(--primary-glow);
            filter: drop-shadow(0 0 5px var(--primary-glow));
        }

        .btn-primary {
            background: var(--primary-glow);
            color: black;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s ease;
        }

        .btn-primary:active {
            transform: scale(0.95);
            opacity: 0.9;
        }

        .loader-screen {
            position: fixed;
            inset: 0;
            background: var(--bg-deep);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }

        .admin-badge {
            background: linear-gradient(90deg, #facc15, #eab308);
            color: black;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body class="selection:bg-green-500/30">

    <!-- Background Elements -->
    <div class="cyber-bg"></div>
    <div class="vapor-cloud"></div>

    <!-- Loader -->
    <div id="loader" class="loader-screen">
        <div class="w-16 h-16 border-4 border-green-500/20 border-t-green-500 rounded-full animate-spin mb-4"></div>
        <h1 class="font-black italic text-xl tracking-tighter">VŒõPOR CLOUD</h1>
    </div>

    <!-- Main Container -->
    <div id="app" class="hidden min-h-screen pb-32">
        
        <!-- Header -->
        <header class="p-6 flex justify-between items-center sticky top-0 z-40 glass border-b-0 rounded-b-3xl">
            <div>
                <h1 class="font-black italic text-2xl tracking-tighter leading-none">VŒõPOR <span class="text-green-500">CLOUD</span></h1>
                <p id="user-greeting" class="text-[10px] text-white/40 uppercase tracking-widest mt-1">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</p>
            </div>
            <div class="flex items-center gap-3">
                <button id="admin-add-btn" class="hidden glass p-3 rounded-2xl neon-drop" onclick="window.ui.toggleModal('add-product-modal')">
                    <i data-lucide="plus" class="w-5 h-5 text-green-500"></i>
                </button>
                <div class="relative" onclick="window.ui.switchView('cart')">
                    <i data-lucide="shopping-cart" class="w-6 h-6"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-green-500 text-black text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full hidden">0</span>
                </div>
            </div>
        </header>

        <!-- View: Store -->
        <main id="view-store" class="p-4 space-y-6">
            <!-- Categories -->
            <div class="flex overflow-x-auto hide-scrollbar gap-3 py-4">
                <button onclick="window.ui.filterCategory('all')" class="cat-btn px-6 py-3 rounded-2xl glass whitespace-nowrap text-sm font-bold border-green-500/50 text-green-500">–í—Å–µ</button>
                <button onclick="window.ui.filterCategory('devices')" class="cat-btn px-6 py-3 rounded-2xl glass whitespace-nowrap text-sm font-bold opacity-50">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>
                <button onclick="window.ui.filterCategory('disposables')" class="cat-btn px-6 py-3 rounded-2xl glass whitespace-nowrap text-sm font-bold opacity-50">–û–¥–Ω–æ—Ä–∞–∑–∫–∏</button>
                <button onclick="window.ui.filterCategory('liquids')" class="cat-btn px-6 py-3 rounded-2xl glass whitespace-nowrap text-sm font-bold opacity-50">–ñ–∏–¥–∫–æ—Å—Ç–∏</button>
            </div>

            <!-- Grid -->
            <div id="product-grid" class="grid grid-cols-2 gap-4">
                <!-- Skeleton / Dynamic items -->
            </div>
        </main>

        <!-- View: Profile -->
        <main id="view-profile" class="hidden p-6 space-y-6">
            <div class="glass rounded-3xl p-8 text-center space-y-4">
                <div id="profile-avatar" class="w-24 h-24 bg-green-500/10 rounded-full mx-auto flex items-center justify-center border-2 border-green-500/20">
                    <i data-lucide="user" class="w-12 h-12 text-green-500"></i>
                </div>
                <div>
                    <h2 id="profile-name" class="text-2xl font-bold">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
                    <p id="profile-username" class="text-white/40">@username</p>
                    <div id="profile-rank" class="mt-2 flex justify-center"></div>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="glass p-5 rounded-3xl text-center">
                    <p class="text-xs text-white/40 uppercase">–ó–∞–∫–∞–∑–æ–≤</p>
                    <p class="text-xl font-bold mt-1">0</p>
                </div>
                <div class="glass p-5 rounded-3xl text-center">
                    <p class="text-xs text-white/40 uppercase">–°–∫–∏–¥–∫–∞</p>
                    <p class="text-xl font-bold mt-1">3%</p>
                </div>
            </div>

            <button class="w-full glass p-5 rounded-3xl flex justify-between items-center" onclick="window.Telegram.WebApp.close()">
                <span class="font-bold">–í—ã–π—Ç–∏ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
                <i data-lucide="log-out" class="w-5 h-5 text-red-500"></i>
            </button>
        </main>

        <!-- Floating Bottom Nav -->
        <nav class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[85%] max-w-md glass rounded-[2.5rem] p-3 flex justify-between items-center shadow-2xl z-50">
            <button onclick="window.ui.switchView('store')" id="nav-store" class="flex-1 flex flex-col items-center gap-1 active-tab">
                <i data-lucide="layout-grid" class="w-6 h-6"></i>
                <span class="text-[9px] uppercase font-bold tracking-tighter">–ú–∞–≥–∞–∑–∏–Ω</span>
            </button>
            <button onclick="window.ui.switchView('profile')" id="nav-profile" class="flex-1 flex flex-col items-center gap-1 opacity-40">
                <i data-lucide="user" class="w-6 h-6"></i>
                <span class="text-[9px] uppercase font-bold tracking-tighter">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
        </nav>
    </div>

    <!-- Cart Sidebar / Bottom Sheet -->
    <div id="cart-sheet" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] hidden opacity-0 transition-opacity duration-300">
        <div class="absolute bottom-0 left-0 right-0 glass rounded-t-[3rem] p-8 translate-y-full transition-transform duration-300 max-h-[85vh] flex flex-col">
            <div class="w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-6"></div>
            
            <h2 class="text-2xl font-black italic tracking-tighter mb-6 flex justify-between items-center">
                –ö–û–†–ó–ò–ù–ê
                <button onclick="window.ui.toggleCart(false)"><i data-lucide="x" class="w-6 h-6"></i></button>
            </h2>

            <div id="cart-items" class="flex-grow overflow-y-auto space-y-4 pr-2 mb-6">
                <!-- Cart Content -->
            </div>

            <div class="border-t border-white/10 pt-6 space-y-4">
                <div class="flex justify-between items-center text-lg font-bold">
                    <span class="text-white/40">–ò–¢–û–ì–û</span>
                    <span id="cart-total" class="text-green-500">0 ‚ÇΩ</span>
                </div>
                <button onclick="window.ui.initCheckout()" class="btn-primary w-full py-5 rounded-2xl shadow-[0_0_20px_rgba(34,197,94,0.3)]">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 z-[70] flex items-center justify-center p-6 hidden">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl"></div>
        <div class="glass relative w-full max-w-sm rounded-[3rem] p-8 text-center space-y-6">
            <div class="w-20 h-20 bg-green-500/10 rounded-full mx-auto flex items-center justify-center border-2 border-green-500/20">
                <i data-lucide="credit-card" class="w-10 h-10 text-green-500"></i>
            </div>
            <div>
                <h3 class="text-2xl font-bold mb-2">–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h3>
                <p class="text-sm text-white/60">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã:</p>
            </div>
            
            <div class="bg-white/5 rounded-3xl p-6 text-left space-y-3">
                <div>
                    <p class="text-[10px] uppercase text-white/40">–û–ó–û–ù –ë–ê–ù–ö</p>
                    <p class="font-mono text-lg select-all">2204 3209 2444 1944</p>
                </div>
                <div>
                    <p class="text-[10px] uppercase text-white/40">–ü–û–õ–£–ß–ê–¢–ï–õ–¨</p>
                    <p class="font-bold">–ò–≤–∞–Ω –í. –†.</p>
                </div>
                <div class="pt-2 border-t border-white/5">
                    <p class="text-[10px] uppercase text-white/40">–ö–û–î –ó–ê–ö–ê–ó–ê (–£–∫–∞–∂–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)</p>
                    <p id="order-code" class="text-green-500 font-black text-xl tracking-widest"></p>
                </div>
            </div>

            <button onclick="window.ui.finishOrder()" class="btn-primary w-full py-4 rounded-2xl">–Ø –û–ü–õ–ê–¢–ò–õ</button>
        </div>
    </div>

    <!-- Admin Add Product Modal -->
    <div id="add-product-modal" class="fixed inset-0 z-[70] flex items-center justify-center p-6 hidden">
        <div class="absolute inset-0 bg-black/95" onclick="window.ui.toggleModal('add-product-modal')"></div>
        <div class="glass relative w-full max-w-sm rounded-[3rem] p-8 space-y-4">
            <h3 class="text-xl font-bold">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
            <input id="admin-p-name" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:border-green-500 outline-none">
            <input id="admin-p-price" type="number" placeholder="–¶–µ–Ω–∞ (‚ÇΩ)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:border-green-500 outline-none">
            <select id="admin-p-cat" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:border-green-500 outline-none text-white/40">
                <option value="devices">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option>
                <option value="disposables">–û–¥–Ω–æ—Ä–∞–∑–∫–∏</option>
                <option value="liquids">–ñ–∏–¥–∫–æ—Å—Ç–∏</option>
            </select>
            <input id="admin-p-emoji" type="text" placeholder="–≠–º–æ–¥–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä üí®)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:border-green-500 outline-none">
            <button onclick="window.ui.adminSaveProduct()" class="btn-primary w-full py-4 rounded-2xl">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <script type="module">
        const { initializeApp, getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, updateDoc, deleteDoc, onSnapshot, query, where, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } = window.fb;

        // Constants
        const ADMIN_ID = 1262669099;
        const ADMIN_USERNAME = "Tru5tNoBody";
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'vape-premium-v1';
        const firebaseConfig = JSON.parse(__firebase_config);

        // State
        let db, auth, user;
        let products = [];
        let cart = [];
        let currentCategory = 'all';

        // Initial Registry
        window.ui = {
            switchView: (view) => {
                document.querySelectorAll('main').forEach(m => m.classList.add('hidden'));
                document.getElementById(`view-${view}`).classList.remove('hidden');
                
                // Nav UI
                document.querySelectorAll('nav button').forEach(b => b.classList.add('opacity-40'));
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
                document.getElementById(`nav-${view}`).classList.remove('opacity-40');
                document.getElementById(`nav-${view}`).classList.add('active-tab');
            },

            toggleCart: (show) => {
                const sheet = document.getElementById('cart-sheet');
                const content = sheet.querySelector('div');
                if (show) {
                    sheet.classList.remove('hidden');
                    setTimeout(() => {
                        sheet.classList.remove('opacity-0');
                        content.classList.remove('translate-y-full');
                    }, 10);
                    window.ui.renderCart();
                } else {
                    sheet.classList.add('opacity-0');
                    content.classList.add('translate-y-full');
                    setTimeout(() => sheet.classList.add('hidden'), 300);
                }
            },

            addToCart: (pid) => {
                const p = products.find(x => x.id === pid);
                const exists = cart.find(x => x.id === pid);
                if (exists) {
                    exists.qty++;
                } else {
                    cart.push({ ...p, qty: 1 });
                }
                window.ui.updateCartBadge();
                window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
            },

            updateCartQty: (pid, delta) => {
                const idx = cart.findIndex(x => x.id === pid);
                if (idx === -1) return;
                cart[idx].qty += delta;
                if (cart[idx].qty <= 0) cart.splice(idx, 1);
                window.ui.updateCartBadge();
                window.ui.renderCart();
            },

            updateCartBadge: () => {
                const count = cart.reduce((a, b) => a + b.qty, 0);
                const badge = document.getElementById('cart-count');
                if (count > 0) {
                    badge.innerText = count;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            },

            renderCart: () => {
                const container = document.getElementById('cart-items');
                if (cart.length === 0) {
                    container.innerHTML = `<div class="text-center py-20 text-white/20"><i data-lucide="shopping-bag" class="w-12 h-12 mx-auto mb-4 opacity-20"></i><p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p></div>`;
                } else {
                    container.innerHTML = cart.map(item => `
                        <div class="glass p-4 rounded-2xl flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 glass rounded-xl flex items-center justify-center text-xl">${item.emoji || 'üí®'}</div>
                                <div>
                                    <p class="font-bold text-sm leading-tight">${item.name}</p>
                                    <p class="text-green-500 text-xs">${item.price} ‚ÇΩ</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 glass p-1 rounded-xl">
                                <button onclick="window.ui.updateCartQty('${item.id}', -1)" class="w-8 h-8 flex items-center justify-center text-white/40">-</button>
                                <span class="w-6 text-center font-bold text-sm">${item.qty}</span>
                                <button onclick="window.ui.updateCartQty('${item.id}', 1)" class="w-8 h-8 flex items-center justify-center text-green-500">+</button>
                            </div>
                        </div>
                    `).join('');
                }
                const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
                document.getElementById('cart-total').innerText = `${total} ‚ÇΩ`;
            },

            filterCategory: (cat) => {
                currentCategory = cat;
                document.querySelectorAll('.cat-btn').forEach(btn => {
                    btn.classList.add('opacity-50');
                    btn.classList.remove('border-green-500/50', 'text-green-500');
                });
                event.target.classList.remove('opacity-50');
                event.target.classList.add('border-green-500/50', 'text-green-500');
                window.ui.renderProducts();
            },

            renderProducts: () => {
                const grid = document.getElementById('product-grid');
                const filtered = currentCategory === 'all' ? products : products.filter(p => p.category === currentCategory);
                
                grid.innerHTML = filtered.map(p => `
                    <div class="glass p-4 rounded-[2rem] flex flex-col h-full relative group">
                        ${user?.id === ADMIN_ID || user?.username === ADMIN_USERNAME ? 
                            `<button onclick="window.ui.adminDelete('${p.id}')" class="absolute top-3 right-3 p-2 bg-red-500/10 text-red-500 rounded-full">
                                <i data-lucide="trash-2" class="w-3 h-3"></i>
                            </button>` : ''}
                        <div class="aspect-square glass rounded-2xl mb-4 flex items-center justify-center text-4xl shadow-inner">
                            ${p.emoji || 'üí®'}
                        </div>
                        <div class="flex-grow">
                            <h3 class="font-bold text-sm leading-tight mb-1">${p.name}</h3>
                            <p class="text-green-500 font-black text-lg">${p.price} ‚ÇΩ</p>
                        </div>
                        <button onclick="window.ui.addToCart('${p.id}')" class="mt-4 w-full glass py-3 rounded-xl text-xs font-black uppercase tracking-widest text-white active:scale-95 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="plus" class="w-3 h-3"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                        </button>
                    </div>
                `).join('');
                lucide.createIcons();
            },

            toggleModal: (id) => {
                const el = document.getElementById(id);
                el.classList.toggle('hidden');
            },

            adminSaveProduct: async () => {
                const name = document.getElementById('admin-p-name').value;
                const price = Number(document.getElementById('admin-p-price').value);
                const cat = document.getElementById('admin-p-cat').value;
                const emoji = document.getElementById('admin-p-emoji').value;
                
                if (!name || !price) return;
                
                await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'products'), {
                    name, price, category: cat, emoji, created: Date.now()
                });
                
                window.ui.toggleModal('add-product-modal');
                // Form cleanup
                document.getElementById('admin-p-name').value = '';
                document.getElementById('admin-p-price').value = '';
            },

            adminDelete: async (pid) => {
                if(confirm("–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?")) {
                    await deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', pid));
                }
            },

            initCheckout: () => {
                if (cart.length === 0) return;
                const code = "VX-" + Math.floor(100 + Math.random() * 899);
                document.getElementById('order-code').innerText = code;
                window.ui.toggleCart(false);
                window.ui.toggleModal('checkout-modal');
            },

            finishOrder: () => {
                const orderData = {
                    code: document.getElementById('order-code').innerText,
                    items: cart,
                    total: cart.reduce((a, b) => a + (b.price * b.qty), 0),
                    user: user
                };
                window.Telegram.WebApp.sendData(JSON.stringify(orderData));
                window.Telegram.WebApp.close();
            }
        };

        // Mutation Observer for Icons
        const observer = new MutationObserver(() => lucide.createIcons());
        observer.observe(document.body, { childList: true, subtree: true });

        // Firebase & Auth Init
        async function initApp() {
            // Safety Timeout
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                }, 500);
            }, 3000);

            const fbApp = initializeApp(firebaseConfig);
            db = getFirestore(fbApp);
            auth = getAuth(fbApp);

            // Triple-Check TG User
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            
            let tgUser = tg.initDataUnsafe?.user;
            if(!tgUser) {
                const params = new URLSearchParams(window.location.hash.slice(1));
                try { tgUser = JSON.parse(params.get('user')); } catch(e) {}
            }

            user = tgUser || { id: 999, first_name: "Guest", username: "guest_vaper" };
            
            // Auth Flow
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }

            onAuthStateChanged(auth, (fbUser) => {
                if (!fbUser) return;
                
                // Set Profile
                document.getElementById('user-greeting').innerText = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}!`;
                document.getElementById('profile-name').innerText = `${user.first_name} ${user.last_name || ''}`;
                document.getElementById('profile-username').innerText = user.username ? `@${user.username}` : `ID: ${user.id}`;
                
                // Admin Check
                if (user.id === ADMIN_ID || user.username === ADMIN_USERNAME) {
                    document.getElementById('admin-add-btn').classList.remove('hidden');
                    document.getElementById('profile-rank').innerHTML = `<span class="admin-badge">ADMINISTRATOR</span>`;
                }

                // Load Data
                const productsCol = collection(db, 'artifacts', APP_ID, 'public', 'data', 'products');
                onSnapshot(productsCol, (snapshot) => {
                    products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    
                    // Auto-seed if empty
                    if (products.length === 0) seedDatabase();
                    
                    window.ui.renderProducts();
                    
                    // Hide loader after data
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                }, (err) => console.error("Firestore error:", err));
            });
        }

        async function seedDatabase() {
            const seeds = [
                { name: "Lost Mary OS5000", price: 1200, category: "disposables", emoji: "üçì" },
                { name: "Vaporesso XROS 3", price: 3200, category: "devices", emoji: "‚ö°" },
                { name: "Bad Drip - Bad Blood", price: 1500, category: "liquids", emoji: "üíâ" },
                { name: "Elf Bar BC5000", price: 1100, category: "disposables", emoji: "üçá" },
                { name: "Geekvape Aegis L200", price: 5800, category: "devices", emoji: "üõ°Ô∏è" },
                { name: "Jam Monster Apple", price: 1400, category: "liquids", emoji: "üçé" },
                { name: "Smoant Pasito II", price: 2900, category: "devices", emoji: "üßä" },
                { name: "HQD Cuvie Plus", price: 950, category: "disposables", emoji: "ü•≠" }
            ];
            const col = collection(db, 'artifacts', APP_ID, 'public', 'data', 'products');
            for (const item of seeds) {
                await addDoc(col, { ...item, created: Date.now() });
            }
        }

        window.onload = initApp;

    </script>
</body>
</html>
