<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Vape Premium Store</title>
    <!-- Tailwind & Lucide -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        :root {
            --primary: #00ff41;
            --primary-glow: rgba(0, 255, 65, 0.4);
            --secondary: #004d13;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ñ–µ—Ä—ã */
        .blob {
            position: absolute;
            filter: blur(80px);
            z-index: -1;
            border-radius: 50%;
            opacity: 0.5;
            pointer-events: none;
        }
        .blob-1 { width: 300px; height: 300px; background: var(--primary); top: -100px; left: -100px; animation: float 15s infinite alternate; }
        .blob-2 { width: 250px; height: 250px; background: #8a2be2; bottom: 10%; right: -50px; animation: float 12s infinite alternate-reverse; }
        .blob-3 { width: 200px; height: 200px; background: #ff00ff; top: 30%; right: 10%; opacity: 0.2; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(40px, 60px) scale(1.1); }
        }

        /* –°–ø–µ—Ü-—ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã */
        .shimmer {
            position: relative;
            overflow: hidden;
        }
        .shimmer::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        /* –ó–∞–≥—Ä—É–∑—á–∏–∫ */
        #main-loader {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <!-- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–≥—Ä—É–∑—á–∏–∫ (–≤–∏–¥–µ–Ω —Å—Ä–∞–∑—É) -->
    <div id="main-loader">
        <div class="relative w-20 h-20">
            <div class="absolute inset-0 border-4 border-[var(--primary)] border-t-transparent rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center font-black text-[var(--primary)] italic text-xs">LUXE</div>
        </div>
        <p class="mt-4 text-[var(--primary)] font-bold tracking-[0.3em] text-[10px] animate-pulse">–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø</p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div id="app" class="relative min-h-screen pb-10">
        <!-- –§–æ–Ω (–≤—Å–µ–≥–¥–∞ –Ω–∞ –º–µ—Å—Ç–µ) -->
        <div class="fixed inset-0 overflow-hidden pointer-events-none z-[-1]">
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
            <div class="blob blob-3"></div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å—é–¥–∞ -->
        <div id="content"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥–æ–≤
        const getSafeConfig = (key, fallback = '{}') => {
            try { return JSON.parse(window[key] || fallback); } 
            catch(e) { return JSON.parse(fallback); }
        };

        const firebaseConfig = getSafeConfig('__firebase_config');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'vape-premium-tma';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        let db, auth;
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch(e) { console.error("Firebase init failed", e); }

        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // State
        let state = {
            user: null,
            isAdmin: false,
            items: [],
            cart: [],
            category: '–í—Å–µ',
            theme: 'toxic',
            isCartOpen: false,
            isCheckoutOpen: false,
            loading: true
        };

        const ADMIN_ID = "1262669099";

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞
        const checkAdmin = () => {
            const user = tg.initDataUnsafe?.user;
            if (user?.id?.toString() === ADMIN_ID) {
                state.isAdmin = true;
                render();
            }
        };

        // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –¥–∞–Ω–Ω—ã–µ (–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
        const initData = () => {
            if (!db || !auth.currentUser) return;
            
            const collectionPath = collection(db, 'artifacts', appId, 'public', 'data', 'vape_items');
            
            // Snapshot listener —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
            onSnapshot(collectionPath, (snapshot) => {
                state.items = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                state.loading = false;
                hideLoader();
                render();
            }, (err) => {
                console.error("Firestore error:", err.message);
                state.loading = false;
                hideLoader();
                render();
            });
        };

        const hideLoader = () => {
            const loader = document.getElementById('main-loader');
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(() => loader.remove(), 500);
            }
        };

        // –†–µ–Ω–¥–µ—Ä
        window.render = () => {
            const container = document.getElementById('content');
            if (!container) return;
            
            const total = state.cart.reduce((s, i) => s + i.price * i.count, 0);
            const filtered = state.category === '–í—Å–µ' ? state.items : state.items.filter(i => i.category === state.category);

            container.innerHTML = `
                <!-- Header -->
                <header class="sticky top-0 z-40 bg-black/50 backdrop-blur-xl border-b border-white/5 px-6 py-5 flex items-center justify-between">
                    <div>
                        <h1 class="text-[var(--primary)] font-black text-2xl italic tracking-tighter leading-none uppercase">Vape Luxe</h1>
                        <p class="text-[8px] uppercase tracking-[0.4em] text-white/30 font-bold mt-1">
                            ${state.isAdmin ? '<span class="text-[var(--primary)] animate-pulse tracking-widest">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>' : '–ü—Ä–µ–º–∏—É–º –ú–∞–≥–∞–∑–∏–Ω'}
                        </p>
                    </div>
                    <div class="flex gap-2">
                        ${state.isAdmin ? `
                            <button onclick="window.seed()" class="w-10 h-10 rounded-xl glass flex items-center justify-center text-[var(--primary)]">
                                <i data-lucide="database" class="w-5 h-5"></i>
                            </button>
                        ` : ''}
                        <button onclick="tg.close()" class="w-10 h-10 rounded-xl glass flex items-center justify-center text-white/40">
                            <i data-lucide="log-out" class="w-5 h-5"></i>
                        </button>
                    </div>
                </header>

                <!-- Filters -->
                <nav class="flex gap-2 p-4 overflow-x-auto no-scrollbar sticky top-[76px] z-30 bg-black/20 backdrop-blur-md">
                    ${['–í—Å–µ', '–û–¥–Ω–æ—Ä–∞–∑–∫–∏', '–ñ–∏–¥–∫–æ—Å—Ç–∏', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞'].map(c => `
                        <button onclick="window.setCat('${c}')" class="px-6 py-2.5 rounded-full text-[10px] font-black uppercase tracking-widest transition-all border
                            ${state.category === c ? 'bg-[var(--primary)] text-black border-transparent shadow-[0_0_20px_var(--primary-glow)]' : 'bg-white/5 text-white/40 border-white/5'}">
                            ${c}
                        </button>
                    `).join('')}
                </nav>

                <!-- Grid -->
                <main class="grid grid-cols-2 gap-4 p-4 pb-32">
                    ${filtered.length === 0 ? `
                        <div class="col-span-2 py-20 text-center opacity-20 font-black uppercase tracking-widest text-xs">–í–∏—Ç—Ä–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
                    ` : filtered.map(item => `
                        <div class="glass rounded-[2rem] p-4 flex flex-col h-full relative group animate-fade-in">
                            ${state.isAdmin ? `
                                <button onclick="window.del('${item.id}')" class="absolute top-3 right-3 w-8 h-8 rounded-full bg-red-500/20 text-red-500 flex items-center justify-center border border-red-500/20 z-10">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            ` : ''}
                            <div class="aspect-square flex items-center justify-center text-5xl mb-4 bg-white/5 rounded-3xl relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-br from-[var(--primary)]/10 to-transparent"></div>
                                <span class="relative z-10">${item.icon || 'üí®'}</span>
                            </div>
                            <div class="flex-grow">
                                <h3 class="text-white font-bold text-sm leading-tight">${item.name}</h3>
                                <p class="text-white/30 text-[9px] mt-1 line-clamp-2">${item.desc || ''}</p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-white/5">
                                <div class="flex justify-between items-center mb-3">
                                    <span class="text-[var(--primary)] font-black text-lg">${item.price} ‚ÇΩ</span>
                                </div>
                                <button onclick="window.add('${item.id}')" class="w-full py-3.5 rounded-2xl bg-white/5 border border-white/10 text-white font-black text-[10px] uppercase tracking-widest active:scale-95 transition-all hover:bg-[var(--primary)] hover:text-black">
                                    –í –∫–æ—Ä–∑–∏–Ω—É
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </main>

                <!-- Floating Cart -->
                ${state.cart.length > 0 ? `
                    <div class="fixed bottom-6 left-6 right-6 z-50">
                        <button onclick="window.toggleCart()" class="w-full h-16 rounded-3xl bg-[var(--primary)] text-black flex items-center justify-between px-8 shadow-[0_20px_40px_rgba(0,0,0,0.5)] shimmer border-t border-white/30">
                            <div class="flex items-center gap-3">
                                <span class="bg-black/20 w-8 h-8 rounded-lg flex items-center justify-center font-black text-xs">${state.cart.reduce((a,b)=>a+b.count, 0)}</span>
                                <span class="font-black text-xs uppercase tracking-[0.2em]">–ö–æ—Ä–∑–∏–Ω–∞</span>
                            </div>
                            <span class="font-black text-xl">${total} ‚ÇΩ</span>
                        </button>
                    </div>
                ` : ''}

                <!-- Cart Sheet -->
                ${state.isCartOpen ? `
                    <div class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-md animate-fade-in" onclick="window.toggleCart()">
                        <div class="absolute bottom-0 left-0 right-0 glass rounded-t-[3rem] p-8 max-h-[85vh] flex flex-col" onclick="event.stopPropagation()">
                            <div class="w-16 h-1 bg-white/10 rounded-full mx-auto mb-8"></div>
                            <h2 class="text-3xl font-black italic mb-8 tracking-tighter">–í–ê–® –ó–ê–ö–ê–ó</h2>
                            <div class="flex-grow overflow-y-auto space-y-4 no-scrollbar">
                                ${state.cart.map(i => `
                                    <div class="flex items-center gap-4 bg-white/5 p-4 rounded-3xl border border-white/5">
                                        <div class="w-14 h-14 rounded-2xl bg-black flex items-center justify-center text-3xl border border-white/5">${i.icon}</div>
                                        <div class="flex-grow">
                                            <h4 class="text-xs font-bold text-white">${i.name}</h4>
                                            <p class="text-[var(--primary)] font-black text-sm">${i.price} ‚ÇΩ</p>
                                        </div>
                                        <div class="flex items-center gap-4 bg-black/40 p-2.5 rounded-2xl border border-white/5">
                                            <button onclick="window.mod('${i.id}', -1)" class="text-white/40"><i data-lucide="minus" class="w-4 h-4"></i></button>
                                            <span class="font-black text-sm text-white">${i.count}</span>
                                            <button onclick="window.mod('${i.id}', 1)" class="text-[var(--primary)]"><i data-lucide="plus" class="w-4 h-4"></i></button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-8 pt-8 border-t border-white/10">
                                <div class="flex justify-between items-end mb-8">
                                    <span class="text-white/20 font-black uppercase text-[10px] tracking-widest">–ö –æ–ø–ª–∞—Ç–µ:</span>
                                    <span class="text-4xl font-black text-[var(--primary)] tracking-tighter">${total} ‚ÇΩ</span>
                                </div>
                                <button onclick="window.checkout()" class="w-full py-6 rounded-[2rem] bg-[var(--primary)] text-black font-black uppercase tracking-[0.3em] shadow-[0_10px_40px_var(--primary-glow)] text-xs">
                                    –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                                </button>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <!-- Checkout Modal -->
                ${state.isCheckoutOpen ? `
                    <div class="fixed inset-0 z-[100] bg-black p-8 overflow-y-auto">
                        <header class="flex items-center justify-between mb-12">
                            <button onclick="window.closeCheckout()" class="text-white/20"><i data-lucide="arrow-left"></i></button>
                            <h2 class="text-[10px] font-black uppercase tracking-[0.6em] text-white/40">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>
                            <div class="w-6"></div>
                        </header>
                        <div class="space-y-8">
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase text-white/20 ml-5 tracking-widest">–ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                                <input id="f-name" class="w-full glass rounded-[2rem] py-5 px-8 text-white focus:border-[var(--primary)] transition-all outline-none font-bold uppercase placeholder:text-white/10" placeholder="–ò–í–ê–ù">
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase text-white/20 ml-5 tracking-widest">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                <input id="f-phone" class="w-full glass rounded-[2rem] py-5 px-8 text-white focus:border-[var(--primary)] transition-all outline-none font-bold placeholder:text-white/10" placeholder="+7 (___) ___ __ __">
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase text-white/20 ml-5 tracking-widest">–ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏</label>
                                <input id="f-loc" class="w-full glass rounded-[2rem] py-5 px-8 text-white focus:border-[var(--primary)] transition-all outline-none font-bold uppercase placeholder:text-white/10" placeholder="–ú–ï–¢–†–û / –ê–î–†–ï–°">
                            </div>

                            <div class="bg-[var(--secondary)]/20 border border-[var(--primary)]/20 p-6 rounded-[2.5rem] mt-10">
                                <div class="flex items-center gap-3 mb-5">
                                    <div class="w-8 h-8 rounded-full bg-[var(--primary)] flex items-center justify-center text-black font-black text-xs">!</div>
                                    <span class="text-[10px] font-black uppercase tracking-widest text-[var(--primary)]">–û–ø–ª–∞—Ç–∞ Ozon</span>
                                </div>
                                <div class="bg-black/40 p-4 rounded-2xl flex items-center justify-between border border-white/5 mb-4">
                                    <code class="text-white font-mono text-lg tracking-widest">2204 3209 2444 1944</code>
                                    <button onclick="navigator.clipboard.writeText('2204320924441944')" class="text-[var(--primary)]"><i data-lucide="copy" class="w-4 h-4"></i></button>
                                </div>
                                <p class="text-[9px] text-white/20 text-center uppercase font-bold tracking-[0.2em]">–ü–æ–ª—É—á–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á –†.</p>
                            </div>

                            <button onclick="window.finish()" class="w-full py-6 rounded-[2.5rem] bg-[var(--primary)] text-black font-black uppercase tracking-[0.4em] text-xs shadow-[0_20px_40px_rgba(0,0,0,0.5)] mt-6 active:scale-95 transition-transform">
                                –Ø –û–ø–ª–∞—Ç–∏–ª
                            </button>
                        </div>
                    </div>
                ` : ''}
            `;
            lucide.createIcons();
        };

        // –§—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        window.setCat = (c) => { 
            state.category = c; 
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            render(); 
        };
        
        window.add = (id) => {
            const item = state.items.find(i => i.id === id);
            const inCart = state.cart.find(i => i.id === id);
            if (inCart) inCart.count++;
            else state.cart.push({ ...item, count: 1 });
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            render();
        };
        
        window.mod = (id, d) => {
            const item = state.cart.find(i => i.id === id);
            if (item) {
                item.count += d;
                if (item.count <= 0) state.cart = state.cart.filter(i => i.id !== id);
            }
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            render();
        };
        
        window.toggleCart = () => { 
            state.isCartOpen = !state.isCartOpen; 
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            render(); 
        };
        
        window.checkout = () => { 
            state.isCartOpen = false; 
            state.isCheckoutOpen = true; 
            render(); 
        };
        
        window.closeCheckout = () => { 
            state.isCheckoutOpen = false; 
            render(); 
        };
        
        window.finish = () => {
            const order = { 
                id: `VX-${Math.random().toString(36).substr(2, 5).toUpperCase()}`,
                items: state.cart,
                total: state.cart.reduce((s, i) => s + i.price * i.count, 0),
                customer: {
                    name: document.getElementById('f-name').value,
                    phone: document.getElementById('f-phone').value,
                    loc: document.getElementById('f-loc').value
                }
            };
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            tg.sendData(JSON.stringify(order));
            tg.close();
        };
        
        window.del = async (id) => {
            if (!auth.currentUser) return;
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –Ω–∞–≤—Å–µ–≥–¥–∞?')) {
                try {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'vape_items', id));
                    if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('warning');
                } catch(e) {
                    console.error("Delete failed:", e);
                }
            }
        };
        
        window.seed = async () => {
            if (!auth.currentUser) return;
            const data = [
                { name: "HQD Cuvie Plus", price: 850, category: "–û–¥–Ω–æ—Ä–∞–∑–∫–∏", icon: "üí®", desc: "1200 –∑–∞—Ç—è–∂–µ–∫, —á–µ—Ä–Ω–∏–∫–∞", createdAt: Date.now() },
                { name: "Elf Bar BC5000", price: 1200, category: "–û–¥–Ω–æ—Ä–∞–∑–∫–∏", icon: "üçì", desc: "5000 –∑–∞—Ç—è–∂–µ–∫, –∫–ª—É–±–Ω–∏–∫–∞", createdAt: Date.now() },
                { name: "Vaporesso XROS 3", price: 2900, category: "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞", icon: "üîã", desc: "–õ—É—á—à–∞—è –ø–æ–¥-—Å–∏—Å—Ç–µ–º–∞", createdAt: Date.now() },
                { name: "Husky Ice", price: 550, category: "–ñ–∏–¥–∫–æ—Å—Ç–∏", icon: "üßä", desc: "–õ–µ–¥—è–Ω–æ–π –∞—Ä–±—É–∑", createdAt: Date.now() },
                { name: "Lost Mary 5000", price: 1100, category: "–û–¥–Ω–æ—Ä–∞–∑–∫–∏", icon: "üçí", desc: "5000 –∑–∞—Ç—è–∂–µ–∫, –≤–∏—à–Ω—è", createdAt: Date.now() },
                { name: "Brusko Minican", price: 1550, category: "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞", icon: "‚ö°", desc: "–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –¥–µ–≤–∞–π—Å", createdAt: Date.now() }
            ];
            for (const i of data) {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'vape_items'), i);
            }
            if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
        };

        // –ó–∞–ø—É—Å–∫ (Rule 3: Auth Before Queries)
        window.onload = async () => {
            render();
            checkAdmin();

            // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Auth
            const initAuth = async () => {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (e) {
                    console.error("Auth initiation failed:", e);
                }
            };

            await initAuth();

            // 2. –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è Auth –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º Firestore
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    state.user = user;
                    initData(); // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ user !== null
                } else {
                    state.loading = false;
                    hideLoader();
                    render();
                }
            });

            // –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç –≤–µ—á–Ω–æ–≥–æ –ª–æ–∞–¥–µ—Ä–∞
            setTimeout(hideLoader, 4000);
        };
    </script>
</body>
</html>
